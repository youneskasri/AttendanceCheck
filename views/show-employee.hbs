<!DOCTYPE html>
<html>

  <head>
    <title>Show Employee</title>
    {{> links}}
  </head>

  <body class="p-0 bg-light text-dark">
    {{> navbar}}
  
     <!-- Content -->
     <div class="container-fluid mt-4">
        <div class="row">
          <div class="col-6">
              <div class="container-fluid">
                {{> employees/info}}
                {{> employees/stats}}
              </div>
          </div>

          <div class="col-6">
              <div class="container-fluid">
                {{> employees/card}}
                {{> employees/attendances}}
              </div>
          </div>
      </div> 

    {{> scripts}}
  
    <script>
      /* Enable Tooltips */
      $(document).ready(function(){
          $('[data-toggle="tooltip"]').tooltip();
      });
    </script>
    

<div class="modal" id="takePictureModal">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
         <h3>Set a new profile image</h3>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <video id="faceVideo" width="100%" muted>Video stream not available.</video>
        
        <button id="savePicture" class="btn btn-dark">Save</button>
  


         <canvas class="d-none" id="todaysPictureCanvas" width="400" height="300" 
            data-toggle="tooltip" title="Today's picture" data-placement="bottom"></canvas>

          <img src=""  width="200" id="todaysPicture" alt=""/>
        
        <script src="/javascripts/facecamera.js"></script>
        <script>
          
          $("#savePicture").click((evt)=>{

            console.log('savePicture');
            let image = takePicture();
            let idEmployee = $("input[name='idEmp']").val();
            let url = '/employees/'+  idEmployee +'/profileImage'; 
            $.post(url, { image, idEmployee }).done(function(result){
              console.log(result.image.data.toString());
              result.success || true ? $("#empPicture").attr("src", result.image.data.toString())
              : console.log(result);
            });
          });
        </script>
      </div>

    </div>
  </div>
</div>



<script>

  function printElementById(id) {
    var e = document.getElementById(id);
    var ifr = document.createElement('iframe');
    ifr.style='height: 0px; width: 0px; position: absolute'
    document.body.appendChild(ifr);

    $(e).clone().appendTo(ifr.contentDocument.body);
    ifr.contentWindow.print();

    ifr.parentElement.removeChild(ifr);
  }

  $(document).ready(()=>{
    $("button.showAttendance").click(evt => {
      evt.preventDefault();

      let url = $(evt.target).find("span.url").text();
      console.log(url);
      $.get(url).done( function (data){
        showAttendanceModal(data.attendance);
      }); 
     
    });

    $("button#printEmployeeCard").click(evt => {
      printElementById('employeeCard');
    });

  });

  function showAttendanceModal(attendance){
    $("#attendanceDate").val(attendance.date);
    $("#attendanceImage").attr("src",attendance.faceImage.data);

    $("#showAttendanceModal").modal("show");
  }

</script>



  </body>
</html>